---
title: Next.js Starter Template
sidebarTitle: Next.js
description: "Production-ready personality assessment app with ToughTongue AI, Firebase Auth, and Zustand"
---

A complete **MBTI personality assessment application** built with Next.js 15, TypeScript, React 19, Firebase Authentication, and ToughTongue AI. Users can take a personality test, view detailed results, and get personalized AI coaching.

<Note>
  This template demonstrates best practices for integrating ToughTongue AI into a production Next.js
  application, including secure API key handling, iframe event management, and state persistence.
</Note>

## Quick Start

<Steps>
  <Step title="Clone the template">

```bash
npx degit tough-tongue/docs/nextjs-minimal my-ttai-app
cd my-ttai-app
```

  </Step>
  <Step title="Install dependencies">

```bash
pnpm install
```

  </Step>
  <Step title="Configure environment">

```bash
cp .env.example .env.local
```

Add your ToughTongue AI API key (required):

```env .env.local
TOUGH_TONGUE_API_KEY=your_api_key_here
```

Get your API key from the [Developer Portal](https://app.toughtongueai.com/developer?tab=api-keys).

  </Step>
  <Step title="Run the app">

```bash
pnpm dev
```

Visit [http://localhost:3000](http://localhost:3000)

  </Step>
</Steps>

---

## What's Included

<CardGroup cols={2}>
  <Card title="Personality Test" icon="brain">
    AI-powered MBTI assessment via embedded ToughTongue scenario
  </Card>
  <Card title="Results Dashboard" icon="chart-bar">
    Detailed personality analysis with dimension breakdowns
  </Card>
  <Card title="AI Coach" icon="comments">
    Personalized coaching based on your assessed personality type
  </Card>
  <Card title="Admin Panel" icon="shield">
    Session management, API balance, and data export (dev mode)
  </Card>
</CardGroup>

### Tech Stack

- **Next.js 15** with App Router and Turbopack
- **React 19** with TypeScript
- **Tailwind CSS 4** with shadcn/ui components
- **Zustand** for state management with localStorage persistence
- **Firebase Auth** (optional) for Google OAuth

---

## Project Structure

```
nextjs-minimal/
├── app/
│   ├── page.tsx                 # Landing page with MBTI explorer
│   ├── test/page.tsx            # Personality test (iframe embed)
│   ├── results/page.tsx         # Results dashboard with analysis
│   ├── coach/page.tsx           # AI coaching with dynamic context
│   ├── admin/                   # Admin panel (modular components)
│   │   ├── page.tsx             # Main admin page
│   │   └── *.tsx                # Card components (Balance, Sessions, etc.)
│   ├── auth/
│   │   ├── AuthContext.tsx      # Auth provider (Firebase + local)
│   │   └── signin/page.tsx
│   └── api/
│       ├── ttai/client.ts       # Server-side ToughTongue API client
│       ├── sessions/            # Session CRUD + analyze endpoints
│       └── balance/route.ts
│
├── components/
│   ├── TTAIIframe.tsx           # ToughTongue iframe wrapper
│   ├── Header.tsx               # Navigation header
│   ├── index.ts                 # Re-exports (PageHeader, EmptyState, etc.)
│   ├── auth/                    # AuthCard, AuthGuard
│   └── ui/                      # shadcn/ui (button, card, dialog, etc.)
│
├── lib/
│   ├── config.ts                # Centralized environment config
│   ├── constants.ts             # Routes + MBTI type data (16 types)
│   ├── store.ts                 # Zustand store with localStorage
│   ├── firebase.ts              # Firebase initialization
│   └── ttai/                    # ToughTongue client module
│       ├── index.ts             # Public exports
│       ├── constants.ts         # Scenario IDs
│       ├── types.ts             # Type definitions
│       └── client.ts            # URL builders + event handlers
│
└── .env.example                 # Environment template
```

---

## Core Concepts

### 1. ToughTongue AI Integration

The template provides a clean abstraction for ToughTongue AI in `lib/ttai/`:

**Scenario Configuration** (`lib/ttai/constants.ts`):

```typescript
export const SCENARIOS = {
  PERSONALITY_TEST: "your_test_scenario_id",
  PERSONALITY_COACH: "your_coach_scenario_id",
} as const;
```

**Building Embed URLs** (`lib/ttai/client.ts`):

```typescript
import { buildPersonalityTestUrl, buildCoachUrl } from "@/lib/ttai";

// Test URL with user info
const testUrl = buildPersonalityTestUrl({
  userName: "John",
  userEmail: "john@example.com",
});

// Coach URL with personality context
const coachUrl = buildCoachUrl({
  userName: "John",
  userPersonalityAssessment: "User is INTJ - strategic thinker...",
});
```

**Handling Iframe Events**:

```typescript
import { createIframeEventListener } from "@/lib/ttai";

useEffect(() => {
  const cleanup = createIframeEventListener({
    onStart: (event) => {
      console.log("Session started:", event.data.session_id);
    },
    onStop: (event) => {
      console.log("Session completed:", event.data.session_id);
      // Trigger analysis, update state, etc.
    },
    onTerminated: (event) => {
      console.log("Session terminated (max duration reached)");
    },
    onError: (error) => {
      console.error("Error:", error.message);
    },
  });

  return cleanup;
}, []);
```

### 2. Iframe Component

The `TTAIIframe` component wraps the ToughTongue embed with proper permissions:

```typescript
import { TTAIIframe } from "@/components/TTAIIframe";

<TTAIIframe src={embedUrl} className="h-[600px]" />;
```

The component includes:

- `allow="microphone; camera; display-capture"` for voice/video
- Consistent styling with rounded corners and shadow
- Full width/height support

### 3. State Management

The app uses Zustand with localStorage persistence (`lib/store.ts`):

```typescript
import { useAppStore } from "@/lib/store";

function MyComponent() {
  // User data
  const user = useAppStore((s) => s.user);

  // Assessment sessions
  const assessmentSessions = useAppStore((s) => s.assessmentSessions);
  const addAssessmentSession = useAppStore((s) => s.addAssessmentSession);

  // Personality data (from finalized assessment)
  const personalityType = useAppStore((s) => s.userPersonalityType);
  const personalityAssessment = useAppStore((s) => s.userPersonalityAssessment);

  // Session details
  const sessionDetails = useAppStore((s) => s.sessionDetails);
  const updateSessionDetails = useAppStore((s) => s.updateSessionDetails);
}
```

**Key State:**

| State                       | Description                                             |
| --------------------------- | ------------------------------------------------------- |
| `user`                      | Current user (local or Firebase)                        |
| `assessmentSessions`        | Array of test session IDs                               |
| `coachSessions`             | Array of coach session IDs                              |
| `sessionDetails`            | Map of session ID → details (status, duration, results) |
| `userPersonalityType`       | Finalized MBTI type (e.g., "INTJ")                      |
| `userPersonalityAssessment` | Full assessment text for coach context                  |

### 4. Authentication

The template supports two auth modes:

**Local User Auth** (no setup required):

```typescript
const { signInAsLocalUser, currentUser, logout } = useAuth();

// Sign in with just a name
signInAsLocalUser("John");
```

**Firebase Auth** (optional, for Google OAuth):

```typescript
const { signInWithGoogle, currentUser, logout } = useAuth();

// Sign in with Google
await signInWithGoogle();
```

The `AuthGuard` component protects pages:

```typescript
import { AuthGuard } from "@/components/auth";

export default function ProtectedPage() {
  return (
    <AuthGuard title="Sign In Required" description="Create an account to continue">
      <YourContent />
    </AuthGuard>
  );
}
```

### 5. Server-Side API Routes

All ToughTongue API calls go through server-side routes to protect your API key:

```typescript
// Client-side: call your API route
const response = await fetch("/api/sessions/analyze", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ session_id: sessionId }),
});

// Server-side route uses the API key from env
import { analyzeSession } from "@/app/api/ttai/client";
const analysis = await analyzeSession({ session_id });
```

**Available API Routes:**

| Route                   | Method | Description                          |
| ----------------------- | ------ | ------------------------------------ |
| `/api/sessions`         | GET    | List sessions (with scenario filter) |
| `/api/sessions/[id]`    | GET    | Get session details                  |
| `/api/sessions/analyze` | POST   | Analyze a completed session          |
| `/api/balance`          | GET    | Get account balance (admin only)     |

---

## Application Flow

### 1. Landing Page (`/`)

- Hero section with app description
- "How it works" feature cards
- Interactive MBTI type explorer (16 clickable type cards)
- Modal dialogs with type details (traits, strengths, description)

### 2. Personality Test (`/test`)

<Steps>
  <Step title="User clicks Start Assessment">
    The ToughTongue iframe loads with the personality test scenario
  </Step>
  <Step title="Session begins">`onStart` event fires → session ID saved to store</Step>
  <Step title="Conversation completes">
    `onStop` or `onTerminated` fires → session marked complete
  </Step>
  <Step title="User redirected to Results">View and analyze the completed session</Step>
</Steps>

### 3. Results Dashboard (`/results`)

- Lists all assessment sessions
- Fetch session details from API
- Run AI analysis to get:
  - MBTI type with breakdown by dimension
  - Strengths and growth areas
  - Full conversation transcript
- **"Mark as Final"** button saves the assessment for coach personalization

### 4. Personality Coach (`/coach`)

- Requires a finalized assessment (shows prompt if none set)
- Passes personality context via `dynamicVariables`:

```typescript
const coachUrl = buildCoachUrl({
  userName: "John",
  userPersonalityAssessment: "User is INTJ. Energy: Introversion...",
});
```

- The coach scenario uses this context for personalized guidance

### 5. Admin Panel (`/admin`)

<Warning>Only available when `NEXT_PUBLIC_IS_DEV=true`. Disable in production.</Warning>

Features:

- View ToughTongue account balance
- List recent sessions by scenario
- Run analysis on any session
- Local store editor for debugging
- Clear all stored data

---

## Configuration

### Environment Variables

```env .env.local
# Required
TOUGH_TONGUE_API_KEY=your_api_key_here

# Development mode (enables admin panel)
NEXT_PUBLIC_IS_DEV=true

# Admin token (for /admin page)
ADMIN_TOKEN=your_secure_token

# Optional: Firebase (for Google OAuth)
NEXT_PUBLIC_FIREBASE_API_KEY=...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=...
NEXT_PUBLIC_FIREBASE_PROJECT_ID=...
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=...
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=...
NEXT_PUBLIC_FIREBASE_APP_ID=...
```

### Customizing Scenarios

Update `lib/ttai/constants.ts` with your scenario IDs:

```typescript
export const SCENARIOS = {
  PERSONALITY_TEST: "your_test_scenario_id",
  PERSONALITY_COACH: "your_coach_scenario_id",
  // Add more scenarios as needed
  SALES_TRAINING: "your_sales_scenario_id",
} as const;
```

### Customizing App Branding

Edit `lib/config.ts`:

```typescript
export const AppConfig = {
  app: {
    name: "Your App Name",
    shortName: "App",
    description: "Your app description",
  },
  // ...
};
```

### Adding New Pages

1. Create `app/your-page/page.tsx`
2. Add route to `lib/constants.ts`:

```typescript
export const ROUTES = {
  // ...existing routes
  YOUR_PAGE: "/your-page",
} as const;
```

3. Update navigation in `components/Header.tsx`

---

## Deployment

### Vercel (Recommended)

<Steps>
  <Step title="Push to GitHub">Commit your code to a GitHub repository</Step>
  <Step title="Import in Vercel">
    Go to [vercel.com/new](https://vercel.com/new) and import your repo. Set **Root Directory** to
    `nextjs-minimal` if using the monorepo structure.
  </Step>
  <Step title="Add Environment Variables">
    In Project Settings → Environment Variables, add:

    - `TOUGH_TONGUE_API_KEY`
    - `NEXT_PUBLIC_IS_DEV=false` (disable admin in production)
    - Firebase variables (if using)

  </Step>
  <Step title="Deploy">Click Deploy. Vercel will auto-deploy on future pushes.</Step>
</Steps>

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Session not starting">
    **Check:**
    1. `TOUGH_TONGUE_API_KEY` is set correctly in `.env.local`
    2. Scenario ID in `lib/ttai/constants.ts` is valid
    3. Browser has microphone permission
    4. No ad blockers blocking the iframe

    **Debug:** Check browser console for errors from `https://app.toughtongueai.com`

  </Accordion>

  <Accordion title="Analysis returns empty results">
    **Cause:** Session may not have enough conversation data or is still processing.

    **Solution:**
    - Wait a few seconds after session ends before analyzing
    - Ensure the session status is "completed" not "active"
    - Check the session has a duration > 0

  </Accordion>

  <Accordion title="Firebase auth not working">
    **Check:**
    1. All `NEXT_PUBLIC_FIREBASE_*` variables are set
    2. Firebase project has Email/Password and Google providers enabled
    3. Authorized domains include your dev/prod URLs

    **Note:** Firebase is optional. Local user auth works without any Firebase config.

  </Accordion>

  <Accordion title="Coach says assessment is required">
    **Cause:** No finalized personality assessment in store.

    **Solution:**
    1. Go to Results page
    2. Analyze a completed session
    3. Click "Mark as Final" on the session you want to use
    4. Return to Coach page

  </Accordion>

  <Accordion title="Data not persisting">
    **Cause:** Zustand store uses localStorage (per-browser, per-domain).

    **Notes:**
    - Clearing browser data clears saved results
    - Data doesn't sync across browsers/devices
    - For production, consider syncing to a database

  </Accordion>
</AccordionGroup>

---

## Learn More

<CardGroup cols={3}>
  <Card title="Firebase Setup" icon="google" href="/developer/starters/firebase-auth">
    Detailed Firebase authentication guide
  </Card>
  <Card title="API Reference" icon="code" href="/api-reference/overview">
    ToughTongue AI API documentation
  </Card>
  <Card title="Iframe Events" icon="message" href="/developer/iframe">
    Complete iframe integration guide
  </Card>
</CardGroup>
